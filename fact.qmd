---
title: "Заводы"
filters: [remove_title.lua]
---

```{python}
#| echo: false
from enum import Enum
from IPython.display import Markdown
from tabulate import tabulate
ICON_SIZE = 32
class Item_Type(Enum):
    Resource =  "Resources"
    Item = "Items"

def get_icon(name, item_type):
    expr = f"![](./icons/{item_type.value}/{name}.png){{width={ICON_SIZE}}}"
    return expr

def get_item_name_with_icon(name, item_type):
    return name+" " +get_icon(name, item_type)

def get_number_with_color(number):
    number_with_color = "["+str(number)+"]"
    if number < 0:
        return number_with_color+"{.red-text}"
    if number > 0:
        return number_with_color+"{.green-text}"
    return number_with_color+"{.yellow-text}"

class Item(Enum):
    Iron_ingot = "Iron Ingot"
    Copper_ingot = "Copper Ingot"
    Steel_ingot = "Steel Ingot" 
    Concrete = "Concrete"
    Wire = "Wire"
    Cable = "Cable"
    Iron_rod = "Iron Rod"
    Iron_plate = "Iron Plate"
    Screws = "Screws"
    Reinforced_iron_plate = "Reinforced Iron Plate"
    Rotor = "Rotor"
    Modular_frame = "Modular Frame"
    Steel_beam = "Steel Beam"
    Steel_pipe = "Steel Pipe" 
    Encased_industrial_beam = "Encased Industrial Beam"
    Stator = "Stator"
    Smart_plating = "Smart Plating"
    Versatile_framework = "Versatile Framework"
    Automated_wiring = "Automated Wiring"
    Motor = "Motor"
    Heavy_Modular_Frame = "Heavy Modular Frame"

production_rate = {
    Item.Iron_ingot : 30,
    Item.Copper_ingot : 30,
    Item.Wire : 30,
    Item.Cable : 30,
    Item.Concrete : 15,
    Item.Steel_ingot : 30,
    Item.Iron_rod : 15,
    Item.Iron_plate : 20,
    Item.Screws : 40,
    Item.Reinforced_iron_plate : 5,
    Item.Rotor : 4,
    Item.Modular_frame : 2,
    Item.Steel_beam : 15,
    Item.Steel_pipe : 20,
    Item.Encased_industrial_beam : 6,
    Item.Stator : 5,
    Item.Smart_plating : 2,
    Item.Versatile_framework : 5,
    Item.Automated_wiring : 2.5,
    Item.Motor : 10,
    Item.Heavy_Modular_Frame: 2,
}


recipes = {
    Item.Wire: {Item.Copper_ingot: 15},
    Item.Iron_ingot: {},
    Item.Steel_ingot: {},
    Item.Concrete: {},
    Item.Cable: {Item.Wire: 60},
    Item.Iron_rod: {Item.Iron_ingot:15},
    Item.Iron_plate: {Item.Iron_ingot:30},
    Item.Screws: {Item.Iron_rod:10},
    Item.Reinforced_iron_plate: {Item.Iron_plate: 30, Item.Screws:60},
    Item.Rotor: {Item.Iron_rod: 20, Item.Screws:100},
    Item.Modular_frame: {Item.Reinforced_iron_plate:3, Item.Iron_rod:12},
    Item.Steel_beam: {Item.Steel_ingot: 60},
    Item.Steel_pipe: {Item.Steel_ingot: 30},
    Item.Encased_industrial_beam: {Item.Steel_beam: 18, Item.Concrete: 36},
    Item.Stator: {Item.Steel_pipe: 15, Item.Wire: 40},
    Item.Smart_plating: {Item.Reinforced_iron_plate: 2, Item.Rotor: 2},
    Item.Versatile_framework: {Item.Modular_frame: 2.5, Item.Steel_beam: 30},
    Item.Automated_wiring: {Item.Stator: 2.5, Item.Cable: 50},
    Item.Motor: {Item.Stator: 10, Item.Rotor: 10},
    Item.Heavy_Modular_Frame: {Item.Modular_frame: 10, Item.Steel_pipe: 40, Item.Encased_industrial_beam: 10, Item.Screws: 240},
}

```

# MegaFactory

## Вход

```{python}
```

## Схема завода

![](./icons/Diagrams/MegaFactory.png)

```{python}
#| echo: false
# production setup
production_on_floor = {
    Item.Iron_rod: 4,
    Item.Iron_plate: 4,
    Item.Steel_beam: 4,
    Item.Steel_pipe: 4,
    Item.Encased_industrial_beam: 4,
    Item.Screws: 4,
    Item.Reinforced_iron_plate: 4,
    Item.Smart_plating: 4,
    Item.Stator: 4,
    Item.Rotor: 4,
    Item.Modular_frame: 4,
    Item.Versatile_framework: 4,
    Item.Automated_wiring: 4,
    Item.Motor: 2,
    Item.Heavy_Modular_Frame: 2
}

production_floors = {
    Item.Iron_rod: 7,
    Item.Iron_plate: 5,
    Item.Steel_beam: 4,
    Item.Steel_pipe: 2,
    Item.Encased_industrial_beam: 1,
    Item.Screws: 8,
    Item.Reinforced_iron_plate: 2,
    Item.Smart_plating: 1,
    Item.Stator: 2,
    Item.Rotor: 2,
    Item.Modular_frame: 2,
    Item.Versatile_framework: 1,
    Item.Automated_wiring: 1,
    Item.Motor: 1,
    Item.Heavy_Modular_Frame: 2
}
```


## Что производится

```{python}
#| echo: false

def get_production_rates(on_floor, floors):
    production_rates = {}
    for item in on_floor:
        production_rates[item] = on_floor[item]*floors[item]*production_rate[item]
    return production_rates

production_rates = get_production_rates(production_on_floor, production_floors)



```

```{python}
#| echo: false
#| output: asis
def item_consumption_rate(item, count):
    cons_rate = {}
    for ing in recipes[item]:
        cons_rate[ing] = recipes[item][ing]*count
    return cons_rate

def consumption_rate(production_on_floor, production_floors):
    cons_rates = {}
    for item in production_on_floor:
        cons_rates[item] = item_consumption_rate(item, production_on_floor[item]*production_floors[item])
    return cons_rates
```

```{python}
#| echo: false
def show_recipe(recipe):
    recipe_str = ""
    for i in recipe:
        recipe_str = recipe_str + " - "+i.value+ get_icon(i.value, Item_Type.Item)  +" x"+str(recipe[i])+"\n"
    return recipe_str

cons_rate = consumption_rate(production_on_floor, production_floors)
headers = ["Название", "Потребляемые ресурсы"]
Markdown(tabulate([("**"+get_item_name_with_icon(k.value, Item_Type.Item)+" x"+ str(production_rates[k])+"**", show_recipe(v))  for k,v in cons_rate.items()], headers = headers))  

```


## Выход

```{python}
#| echo: false
import copy

def diff_cons_prod(prod_rate, cons_rate):
    diff_cons_prod_rate = copy.deepcopy(prod_rate)
    for cons_item in cons_rate:
        for item in cons_rate[cons_item]:
            if not item in diff_cons_prod_rate.keys():
                diff_cons_prod_rate[item] = 0
            diff_cons_prod_rate[item] -= cons_rate[cons_item][item]
    return diff_cons_prod_rate

diff_c_p  = diff_cons_prod(production_rates,cons_rate)
headers = ["Название", "Разница"]
Markdown(tabulate([("**"+get_item_name_with_icon(k.value, Item_Type.Item)+"**",get_number_with_color(v))  for k,v in diff_c_p.items()], headers = headers))  
```


